<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script>
    function setUp() {
      sp = document.getElementById('output_1');
      mot = [];
      mot_maxs = [];
      calibratin = true;
      cal_timeout = null;
      acting = false;
    }
    function ask() {
      if(DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === "function") {
        DeviceMotionEvent.requestPermission();
      }
      window.addEventListener('devicemotion', (event) => {
        mot = [Math.abs(event.acceleration.x).toFixed(4),Math.abs(event.acceleration.y).toFixed(4),Math.abs(event.acceleration.z).toFixed(4)];
        sp_2.innerHTML = mot.toString();
        //sideways, up and down, back and forth
        if(calibratin) {
          if(mot_mins.length == 0) {
            mot_maxs = [Math.abs(event.acceleration.x).toFixed(4),Math.abs(event.acceleration.y).toFixed(4),Math.abs(event.acceleration.z).toFixed(4)];
          }else{
            mot_maxs = [Math.max(Math.abs(event.acceleration.x).toFixed(4),mot_maxs[0]),Math.max(Math.abs(event.acceleration.y).toFixed(4),mot_maxs[1]),Math.max(Math.abs(event.acceleration.z).toFixed(4),mot_maxs[2])];
          }
        }else{
          if(mot[0] > mot_maxs[0]*1.1 || mot[1] > mot_maxs[1]*1.1 || mot[2] > mot_maxs[2]*1.1) {
            sp.innerHTML = 'Hello Uncle Bertram, are you OK?';
          }
        }
      });
      cal_timeout = setTimeout(function() {
        calibratin = false;
        sp.innerHTML = 'Stillness has been monitored. Movements can now be detected.';
      }, 10000);
    }
    </script>
  </head>
  <body onload="setUp();">
    <h2>Mobile Movement Monitor</h2>
    <span id='output_1'>Please give Uncle Bertram the phone, and then press start to calibrate stillness.</span><br />
    <p>Please note, the phone should be set to avoid time out.</p>
    <button id='permission' onclick="ask();">Start</button>
  </body>
</html>
