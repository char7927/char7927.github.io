<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script>
    function setUp() {
      sp_1 = document.getElementById('output_1');
      sp_2 = document.getElementById('output_2');
      sp_3 = document.getElementById('output_3');
      mot = [];
      mot_mins = [];
      mot_maxs = [];
      ori = [];
      ori_mins = [];
      ori_maxs = [];
      calibratin = true;
      cal_timeout = null;
    }
    function ask() {
      if(DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === "function") {
        DeviceMotionEvent.requestPermission();
      }
      window.addEventListener('deviceorientation', (event) => {
        ori = [Math.round(event.alpha),Math.round(event.beta),Math.round(event.gamma)];
        sp_1.innerHTML = ori.toString();
        if(calibratin) {
          if(ori_mins.length == 0) {
            ori_mins = [Math.round(event.alpha),Math.round(event.beta),Math.round(event.gamma)];
            ori_maxs = [Math.round(event.alpha),Math.round(event.beta),Math.round(event.gamma)];
          }else{
            ori_mins = [Math.min(Math.round(event.alpha),ori_mins[0]),Math.min(Math.round(event.beta),ori_mins[1]),Math.min(Math.round(event.gamma),ori_mins[2])];
            ori_maxs = [Math.max(Math.round(event.alpha),ori_maxs[0]),Math.max(Math.round(event.beta),ori_maxs[1]),Math.max(Math.round(event.gamma),ori_maxs[2])];
          }
        }
      });
      window.addEventListener('devicemotion', (event) => {
        mot = [Math.abs(event.acceleration.x).toFixed(4),Math.abs(event.acceleration.y).toFixed(4),Math.abs(event.acceleration.z).toFixed(4)];
        sp_2.innerHTML = mot.toString();
        if(calibratin) {
          if(mot_mins.length == 0) {
            mot_mins = [Math.abs(event.acceleration.x).toFixed(4),Math.abs(event.acceleration.y).toFixed(4),Math.abs(event.acceleration.z).toFixed(4)];
            mot_maxs = [Math.abs(event.acceleration.x).toFixed(4),Math.abs(event.acceleration.y).toFixed(4),Math.abs(event.acceleration.z).toFixed(4)];
          }else{
            mot_mins = [Math.min(Math.abs(event.acceleration.x).toFixed(4),mot_mins[0]),Math.min(Math.abs(event.acceleration.y).toFixed(4),mot_mins[1]),Math.min(Math.abs(event.acceleration.z).toFixed(4),mot_mins[2])];
            mot_maxs = [Math.max(Math.abs(event.acceleration.x).toFixed(4),mot_maxs[0]),Math.max(Math.abs(event.acceleration.y).toFixed(4),mot_maxs[1]),Math.max(Math.abs(event.acceleration.z).toFixed(4),mot_maxs[2])];
          }
        } 
      });
      cal_timeout = setTimeout(function() {
        calibratin = false;
        sp_3.innerHTML = ori_mins.toString()+"<br />"+ori_maxs.toString();
      }, 10000);
    }
    </script>
  </head>
  <body onload="setUp();">
    <h2>Information plus cal</h2>
    <span id='output_1'>till 2</span><br />
    <span id='output_2'>till 2</span><br />
    <span id='output_3'>till 2</span><br />
    <button id='permission' onclick="ask();">Start</button>
  </body>
</html>
